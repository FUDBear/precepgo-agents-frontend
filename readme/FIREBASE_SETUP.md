# Firebase Integration Guide

## Overview

The frontend is now integrated with Firebase Firestore to view documents generated by the AI Agents. The app can display documents from four collections:

- **agent_evaluations** - Generated by Evaluation Agent
- **agent_scenarios** - Generated by Scenario Agent  
- **agent_notifications** - Generated by Safety/Notification Agent
- **agent_coa_reports** - Generated by COA Agent

## Firebase Configuration

Firebase is configured in `src/config/firebase.ts` with your project credentials:

- **Project ID**: `auth-demo-90be0`
- **Project**: PrecepGo ADK Panel

## Firestore Security Rules

Add these rules to your existing Firestore security rules file. Insert them anywhere within the `match /databases/{database}/documents {` block:

```javascript
// Agent-generated collections - Allow read access for viewing documents
match /agent_evaluations/{document=**} {
  allow read: if request.auth != null;
  allow write: if false; // Only backend can write
}

match /agent_scenarios/{document=**} {
  allow read: if request.auth != null;
  allow write: if false; // Only backend can write
}

match /agent_notifications/{document=**} {
  allow read: if request.auth != null;
  allow write: if false; // Only backend can write
}

match /agent_coa_reports/{document=**} {
  allow read: if request.auth != null;
  allow write: if false; // Only backend can write
}

match /agent_states/{document=**} {
  allow read: if request.auth != null;
  allow write: if false; // Only backend can write
}
```

### Complete Rules Block to Add

Add this section to your existing rules file (inside the `match /databases/{database}/documents {` block):

```javascript
// Agent-generated collections - Allow read access for authenticated users
match /agent_evaluations/{document=**} {
  allow read: if request.auth != null;
  allow write: if false;
}

match /agent_scenarios/{document=**} {
  allow read: if request.auth != null;
  allow write: if false;
}

match /agent_notifications/{document=**} {
  allow read: if request.auth != null;
  allow write: if false;
}

match /agent_coa_reports/{document=**} {
  allow read: if request.auth != null;
  allow write: if false;
}

match /agent_states/{document=**} {
  allow read: if request.auth != null;
  allow write: if false;
}
```

### To Update Security Rules:

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select project: `auth-demo-90be0`
3. Navigate to **Firestore Database** â†’ **Rules**
4. Add the rules above to your existing rules file
5. Click **Publish**

**Note**: The rules require `request.auth != null` (authenticated users). If you want to allow unauthenticated access for testing, you can change `if request.auth != null` to `if true`, but this is **NOT recommended for production**.

## Using the Document Viewer

### Switching Views

1. Click the **ðŸ“„ Documents** tab at the top
2. Select a collection (Evaluations, Scenarios, Notifications, or COA Reports)
3. Documents are displayed with:
   - Document ID (first 8 characters)
   - Creation timestamp
   - Full document data in JSON format

### Auto-Refresh

Documents automatically refresh:
- Every 10 seconds when viewing documents
- Immediately after generating a new document via an agent

### Document Display

Each document card shows:
- **Document ID**: Shortened for display
- **Timestamp**: When the document was created
- **Data**: Full JSON view (scrollable)

## Troubleshooting

### "Permission Denied" Errors

If you see permission errors:
1. Check Firestore security rules (see above)
2. Ensure rules are published
3. Verify you're accessing the correct project

### No Documents Showing

If collections appear empty:
1. Verify agents are generating documents successfully
2. Check Firestore console to see if documents exist
3. Verify collection names match exactly:
   - `agent_evaluations` (not `evaluations`)
   - `agent_scenarios` (not `scenarios`)
   - `agent_notifications` (not `notifications`)
   - `agent_coa_reports` (not `coa_reports`)
   - `agent_states` (for agent state tracking)

### Firestore Connection Issues

1. Check browser console for Firebase errors
2. Verify Firebase config is correct
3. Check network tab for failed Firestore requests

## Collection Structure

Documents are expected to have:
- `createdAt` timestamp field (for sorting)
- Other fields vary by agent type

### Evaluation Documents
- `case_type`
- `preceptee_user_name`
- `preceptor_comment`
- `focus_areas`
- `preceptor_ratings`
- etc.

### Scenario Documents
- `case.name`
- `case.type`
- `patient.full_name`
- `student.name`
- `case_rationale`
- etc.

### Notification Documents
- `evaluation_id`
- `student_name`
- `dangerous_rating`
- `reason`
- etc.

### COA Report Documents
- `violation_type`
- `severity`
- `evaluation_id`
- etc.

## Code Structure

- **Firebase Config**: `src/config/firebase.ts`
- **Firestore Service**: `src/services/firestore.ts`
- **Document Viewer Component**: `src/components/DocumentViewer.tsx`
- **App Integration**: `src/App.tsx`

## Next Steps

1. Update Firestore security rules (see above)
2. Generate some documents using the agents
3. Switch to Documents view to see them
4. Documents will auto-refresh every 10 seconds

